var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){function e(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}e.prototype.diff_main=function(e,t,i,n){if(void 0===n&&(n=0>=this.Diff_Timeout?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout),null==e||null==t)throw Error("Null input. (diff_main)");if(e==t)return e?[[0,e]]:[];void 0===i&&(i=!0);var r=i,a=this.diff_commonPrefix(e,t);i=e.substring(0,a),e=e.substring(a),t=t.substring(a);var a=this.diff_commonSuffix(e,t),o=e.substring(e.length-a);return e=e.substring(0,e.length-a),t=t.substring(0,t.length-a),e=this.diff_compute_(e,t,r,n),i&&e.unshift([0,i]),o&&e.push([0,o]),this.diff_cleanupMerge(e),e},e.prototype.diff_compute_=function(e,t,i,n){if(!e)return[[1,t]];if(!t)return[[-1,e]];var r=e.length>t.length?e:t,a=e.length>t.length?t:e,o=r.indexOf(a);return-1!=o?(i=[[1,r.substring(0,o)],[0,a],[1,r.substring(o+a.length)]],e.length>t.length&&(i[0][0]=i[2][0]=-1),i):1==a.length?[[-1,e],[1,t]]:(r=this.diff_halfMatch_(e,t))?(a=r[0],e=r[1],o=r[2],t=r[3],r=r[4],a=this.diff_main(a,o,i,n),i=this.diff_main(e,t,i,n),a.concat([[0,r]],i)):i&&100<e.length&&100<t.length?this.diff_lineMode_(e,t,n):this.diff_bisect_(e,t,n)},e.prototype.diff_lineMode_=function(e,t,i){var n=this.diff_linesToChars_(e,t);e=n.chars1,t=n.chars2,n=n.lineArray,e=this.diff_main(e,t,!1,i),this.diff_charsToLines_(e,n),this.diff_cleanupSemantic(e),e.push([0,""]);for(var r=n=t=0,a="",o="";t<e.length;){switch(e[t][0]){case 1:r++,o+=e[t][1];break;case-1:n++,a+=e[t][1];break;case 0:if(1<=n&&1<=r){for(e.splice(t-n-r,n+r),t=t-n-r,n=this.diff_main(a,o,!1,i),r=n.length-1;0<=r;r--)e.splice(t,0,n[r]);t+=n.length}n=r=0,o=a=""}t++}return e.pop(),e},e.prototype.diff_bisect_=function(e,t,i){for(var n=e.length,r=t.length,a=Math.ceil((n+r)/2),o=a,l=2*a,f=Array(l),s=Array(l),c=0;c<l;c++)f[c]=-1,s[c]=-1;f[o+1]=0,s[o+1]=0;for(var c=n-r,h=0!=c%2,d=0,u=0,g=0,p=0,m=0;m<a&&!((new Date).getTime()>i);m++){for(var _=-m+d;_<=m-u;_+=2){var v,b=o+_;v=_==-m||_!=m&&f[b-1]<f[b+1]?f[b+1]:f[b-1]+1;for(var y=v-_;v<n&&y<r&&e.charAt(v)==t.charAt(y);)v++,y++;if(f[b]=v,v>n)u+=2;else if(y>r)d+=2;else if(h&&0<=(b=o+c-_)&&b<l&&-1!=s[b]){var I=n-s[b];if(v>=I)return this.diff_bisectSplit_(e,t,v,y,i)}}for(_=-m+g;_<=m-p;_+=2){for(b=o+_,I=_==-m||_!=m&&s[b-1]<s[b+1]?s[b+1]:s[b-1]+1,v=I-_;I<n&&v<r&&e.charAt(n-I-1)==t.charAt(r-v-1);)I++,v++;if(s[b]=I,I>n)p+=2;else if(v>r)g+=2;else if(!h&&0<=(b=o+c-_)&&b<l&&-1!=f[b]&&(v=f[b],y=o+v-b,I=n-I,v>=I))return this.diff_bisectSplit_(e,t,v,y,i)}}return[[-1,e],[1,t]]},e.prototype.diff_bisectSplit_=function(e,t,i,n,r){var a=e.substring(0,i),o=t.substring(0,n);return e=e.substring(i),t=t.substring(n),a=this.diff_main(a,o,!1,r),r=this.diff_main(e,t,!1,r),a.concat(r)},e.prototype.diff_linesToChars_=function(e,t){function i(e){for(var t="",i=0,a=-1,o=n.length;a<e.length-1;){a=e.indexOf("\n",i),-1==a&&(a=e.length-1);var l=e.substring(i,a+1),i=a+1;(r.hasOwnProperty?r.hasOwnProperty(l):void 0!==r[l])?t+=String.fromCharCode(r[l]):(t+=String.fromCharCode(o),r[l]=o,n[o++]=l)}return t}var n=[],r={};return n[0]="",{chars1:i(e),chars2:i(t),lineArray:n}},e.prototype.diff_charsToLines_=function(e,t){for(var i=0;i<e.length;i++){for(var n=e[i][1],r=[],a=0;a<n.length;a++)r[a]=t[n.charCodeAt(a)];e[i][1]=r.join("")}},e.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var i=0,n=Math.min(e.length,t.length),r=n,a=0;i<r;)e.substring(a,r)==t.substring(a,r)?a=i=r:n=r,r=Math.floor((n-i)/2+i);return r},e.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var i=0,n=Math.min(e.length,t.length),r=n,a=0;i<r;)e.substring(e.length-r,e.length-a)==t.substring(t.length-r,t.length-a)?a=i=r:n=r,r=Math.floor((n-i)/2+i);return r},e.prototype.diff_commonOverlap_=function(e,t){var i=e.length,n=t.length;if(0==i||0==n)return 0;if(i>n?e=e.substring(i-n):i<n&&(t=t.substring(0,i)),i=Math.min(i,n),e==t)return i;for(var n=0,r=1;;){var a=e.substring(i-r),a=t.indexOf(a);if(-1==a)return n;r+=a,0!=a&&e.substring(i-r)!=t.substring(0,r)||(n=r,r++)}},e.prototype.diff_halfMatch_=function(e,t){function i(e,t,i){for(var n,r,a,l,f=e.substring(i,i+Math.floor(e.length/4)),s=-1,c="";-1!=(s=t.indexOf(f,s+1));){var h=o.diff_commonPrefix(e.substring(i),t.substring(s)),d=o.diff_commonSuffix(e.substring(0,i),t.substring(0,s));c.length<d+h&&(c=t.substring(s-d,s)+t.substring(s,s+h),n=e.substring(0,i-d),r=e.substring(i+h),a=t.substring(0,s-d),l=t.substring(s+h))}return 2*c.length>=e.length?[n,r,a,l,c]:null}if(0>=this.Diff_Timeout)return null;var n=e.length>t.length?e:t,r=e.length>t.length?t:e;if(4>n.length||2*r.length<n.length)return null;var a,o=this,l=i(n,r,Math.ceil(n.length/4)),n=i(n,r,Math.ceil(n.length/2));if(!l&&!n)return null;a=n?l&&l[4].length>n[4].length?l:n:l;var f;return e.length>t.length?(l=a[0],n=a[1],r=a[2],f=a[3]):(r=a[0],f=a[1],l=a[2],n=a[3]),a=a[4],[l,n,r,f,a]},e.prototype.diff_cleanupSemantic=function(e){for(var t=!1,i=[],n=0,r=null,a=0,o=0,l=0,f=0,s=0;a<e.length;)0==e[a][0]?(i[n++]=a,o=f,l=s,s=f=0,r=e[a][1]):(1==e[a][0]?f+=e[a][1].length:s+=e[a][1].length,r&&r.length<=Math.max(o,l)&&r.length<=Math.max(f,s)&&(e.splice(i[n-1],0,[-1,r]),e[i[n-1]+1][0]=1,n--,n--,a=0<n?i[n-1]:-1,s=f=l=o=0,r=null,t=!0)),a++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),a=1;a<e.length;)-1==e[a-1][0]&&1==e[a][0]&&(t=e[a-1][1],i=e[a][1],n=this.diff_commonOverlap_(t,i),r=this.diff_commonOverlap_(i,t),n>=r?(n>=t.length/2||n>=i.length/2)&&(e.splice(a,0,[0,i.substring(0,n)]),e[a-1][1]=t.substring(0,t.length-n),e[a+1][1]=i.substring(n),a++):(r>=t.length/2||r>=i.length/2)&&(e.splice(a,0,[0,t.substring(0,r)]),e[a-1][0]=1,e[a-1][1]=i.substring(0,i.length-r),e[a+1][0]=-1,e[a+1][1]=t.substring(r),a++),a++),a++},e.prototype.diff_cleanupSemanticLossless=function(t){function i(t,i){if(!t||!i)return 6;var n=t.charAt(t.length-1),r=i.charAt(0),a=n.match(e.nonAlphaNumericRegex_),o=r.match(e.nonAlphaNumericRegex_),l=a&&n.match(e.whitespaceRegex_),f=o&&r.match(e.whitespaceRegex_),n=l&&n.match(e.linebreakRegex_),r=f&&r.match(e.linebreakRegex_),s=n&&t.match(e.blanklineEndRegex_),c=r&&i.match(e.blanklineStartRegex_);return s||c?5:n||r?4:a&&!l&&f?3:l||f?2:a||o?1:0}for(var n=1;n<t.length-1;){if(0==t[n-1][0]&&0==t[n+1][0]){var r=t[n-1][1],a=t[n][1],o=t[n+1][1],l=this.diff_commonSuffix(r,a);if(l)var f=a.substring(a.length-l),r=r.substring(0,r.length-l),a=f+a.substring(0,a.length-l),o=f+o;for(var l=r,f=a,s=o,c=i(r,a)+i(a,o);a.charAt(0)===o.charAt(0);){var r=r+a.charAt(0),a=a.substring(1)+o.charAt(0),o=o.substring(1),h=i(r,a)+i(a,o);h>=c&&(c=h,l=r,f=a,s=o)}t[n-1][1]!=l&&(l?t[n-1][1]=l:(t.splice(n-1,1),n--),t[n][1]=f,s?t[n+1][1]=s:(t.splice(n+1,1),n--))}n++}},e.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,e.whitespaceRegex_=/\s/,e.linebreakRegex_=/[\r\n]/,e.blanklineEndRegex_=/\n\r?\n$/,e.blanklineStartRegex_=/^\r?\n\r?\n/,e.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,i=[],n=0,r=null,a=0,o=!1,l=!1,f=!1,s=!1;a<e.length;)0==e[a][0]?(e[a][1].length<this.Diff_EditCost&&(f||s)?(i[n++]=a,o=f,l=s,r=e[a][1]):(n=0,r=null),f=s=!1):(-1==e[a][0]?s=!0:f=!0,r&&(o&&l&&f&&s||r.length<this.Diff_EditCost/2&&3==o+l+f+s)&&(e.splice(i[n-1],0,[-1,r]),e[i[n-1]+1][0]=1,n--,r=null,o&&l?(f=s=!0,n=0):(n--,a=0<n?i[n-1]:-1,f=s=!1),t=!0)),a++;t&&this.diff_cleanupMerge(e)},e.prototype.diff_cleanupMerge=function(e){e.push([0,""]);for(var t,i=0,n=0,r=0,a="",o="";i<e.length;)switch(e[i][0]){case 1:r++,o+=e[i][1],i++;break;case-1:n++,a+=e[i][1],i++;break;case 0:1<n+r?(0!==n&&0!==r&&(t=this.diff_commonPrefix(o,a),0!==t&&(0<i-n-r&&0==e[i-n-r-1][0]?e[i-n-r-1][1]+=o.substring(0,t):(e.splice(0,0,[0,o.substring(0,t)]),i++),o=o.substring(t),a=a.substring(t)),0!==(t=this.diff_commonSuffix(o,a))&&(e[i][1]=o.substring(o.length-t)+e[i][1],o=o.substring(0,o.length-t),a=a.substring(0,a.length-t))),0===n?e.splice(i-r,n+r,[1,o]):0===r?e.splice(i-n,n+r,[-1,a]):e.splice(i-n-r,n+r,[-1,a],[1,o]),i=i-n-r+(n?1:0)+(r?1:0)+1):0!==i&&0==e[i-1][0]?(e[i-1][1]+=e[i][1],e.splice(i,1)):i++,n=r=0,o=a=""}for(""===e[e.length-1][1]&&e.pop(),n=!1,i=1;i<e.length-1;)0==e[i-1][0]&&0==e[i+1][0]&&(e[i][1].substring(e[i][1].length-e[i-1][1].length)==e[i-1][1]?(e[i][1]=e[i-1][1]+e[i][1].substring(0,e[i][1].length-e[i-1][1].length),e[i+1][1]=e[i-1][1]+e[i+1][1],e.splice(i-1,1),n=!0):e[i][1].substring(0,e[i+1][1].length)==e[i+1][1]&&(e[i-1][1]+=e[i+1][1],e[i][1]=e[i][1].substring(e[i+1][1].length)+e[i+1][1],e.splice(i+1,1),n=!0)),i++;n&&this.diff_cleanupMerge(e)},e.prototype.diff_xIndex=function(e,t){var i,n=0,r=0,a=0,o=0;for(i=0;i<e.length&&(1!==e[i][0]&&(n+=e[i][1].length),-1!==e[i][0]&&(r+=e[i][1].length),!(n>t));i++)a=n,o=r;return e.length!=i&&-1===e[i][0]?o:o+(t-a)},e.prototype.diff_prettyHtml=function(e){for(var t=[],i=/&/g,n=/</g,r=/>/g,a=/\n/g,o=0;o<e.length;o++){var l=e[o][0],f=e[o][1],f=f.replace(i,"&amp;").replace(n,"&lt;").replace(r,"&gt;").replace(a,"&para;<br>");switch(l){case 1:t[o]='<ins style="background:#e6ffe6;">'+f+"</ins>";break;case-1:t[o]='<del style="background:#ffe6e6;">'+f+"</del>";break;case 0:t[o]="<span>"+f+"</span>"}}return t.join("")},e.prototype.diff_text1=function(e){for(var t=[],i=0;i<e.length;i++)1!==e[i][0]&&(t[i]=e[i][1]);return t.join("")},e.prototype.diff_text2=function(e){for(var t=[],i=0;i<e.length;i++)-1!==e[i][0]&&(t[i]=e[i][1]);return t.join("")},e.prototype.diff_levenshtein=function(e){for(var t=0,i=0,n=0,r=0;r<e.length;r++){var a=e[r][0],o=e[r][1];switch(a){case 1:i+=o.length;break;case-1:n+=o.length;break;case 0:t+=Math.max(i,n),n=i=0}}return t+=Math.max(i,n)},e.prototype.diff_toDelta=function(e){for(var t=[],i=0;i<e.length;i++)switch(e[i][0]){case 1:t[i]="+"+encodeURI(e[i][1]);break;case-1:t[i]="-"+e[i][1].length;break;case 0:t[i]="="+e[i][1].length}return t.join("\t").replace(/%20/g," ")},e.prototype.diff_fromDelta=function(e,t){for(var i=[],n=0,r=0,a=t.split(/\t/g),o=0;o<a.length;o++){var l=a[o].substring(1);switch(a[o].charAt(0)){case"+":try{i[n++]=[1,decodeURI(l)]}catch(e){throw Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var f=parseInt(l,10);if(isNaN(f)||0>f)throw Error("Invalid number in diff_fromDelta: "+l);l=e.substring(r,r+=f),"="==a[o].charAt(0)?i[n++]=[0,l]:i[n++]=[-1,l];break;default:if(a[o])throw Error("Invalid diff operation in diff_fromDelta: "+a[o])}}if(r!=e.length)throw Error("Delta length ("+r+") does not equal source text length ("+e.length+").");return i},e.prototype.match_main=function(e,t,i){if(null==e||null==t||null==i)throw Error("Null input. (match_main)");return i=Math.max(0,Math.min(i,e.length)),e==t?0:e.length?e.substring(i,i+t.length)==t?i:this.match_bitap_(e,t,i):-1},e.prototype.match_bitap_=function(e,t,i){function n(e,n){var r=e/t.length,o=Math.abs(i-n);return a.Match_Distance?r+o/a.Match_Distance:o?1:r}if(t.length>this.Match_MaxBits)throw Error("Pattern too long for this browser.");var r=this.match_alphabet_(t),a=this,o=this.Match_Threshold,l=e.indexOf(t,i);-1!=l&&(o=Math.min(n(0,l),o),-1!=(l=e.lastIndexOf(t,i+t.length))&&(o=Math.min(n(0,l),o)));for(var f,s,c,h=1<<t.length-1,l=-1,d=t.length+e.length,u=0;u<t.length;u++){for(f=0,s=d;f<s;)n(u,i+s)<=o?f=s:d=s,s=Math.floor((d-f)/2+f);d=s,f=Math.max(1,i-s+1);var g=Math.min(i+s,e.length)+t.length;for(s=Array(g+2),s[g+1]=(1<<u)-1;g>=f;g--){var p=r[e.charAt(g-1)];if(s[g]=0===u?(s[g+1]<<1|1)&p:(s[g+1]<<1|1)&p|(c[g+1]|c[g])<<1|1|c[g+1],s[g]&h&&(p=n(u,g-1))<=o){if(o=p,!((l=g-1)>i))break;f=Math.max(1,2*i-l)}}if(n(u+1,i)>o)break;c=s}return l},e.prototype.match_alphabet_=function(e){for(var t={},i=0;i<e.length;i++)t[e.charAt(i)]=0;for(i=0;i<e.length;i++)t[e.charAt(i)]|=1<<e.length-i-1;return t},e.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var i=t.substring(e.start2,e.start2+e.length1),n=0;t.indexOf(i)!=t.lastIndexOf(i)&&i.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)n+=this.Patch_Margin,i=t.substring(e.start2-n,e.start2+e.length1+n);n+=this.Patch_Margin,(i=t.substring(e.start2-n,e.start2))&&e.diffs.unshift([0,i]),(n=t.substring(e.start2+e.length1,e.start2+e.length1+n))&&e.diffs.push([0,n]),e.start1-=i.length,e.start2-=i.length,e.length1+=i.length+n.length,e.length2+=i.length+n.length}},e.prototype.patch_make=function(t,i,n){var r;if("string"==typeof t&&"string"==typeof i&&void 0===n)r=t,i=this.diff_main(r,i,!0),2<i.length&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(t&&"object"==(void 0===t?"undefined":_typeof(t))&&void 0===i&&void 0===n)i=t,r=this.diff_text1(i);else if("string"==typeof t&&i&&"object"==(void 0===i?"undefined":_typeof(i))&&void 0===n)r=t;else{if("string"!=typeof t||"string"!=typeof i||!n||"object"!=(void 0===n?"undefined":_typeof(n)))throw Error("Unknown call format to patch_make.");r=t,i=n}if(0===i.length)return[];n=[],t=new e.patch_obj;for(var a=0,o=0,l=0,f=r,s=0;s<i.length;s++){var c=i[s][0],h=i[s][1];switch(!a&&0!==c&&(t.start1=o,t.start2=l),c){case 1:t.diffs[a++]=i[s],t.length2+=h.length,r=r.substring(0,l)+h+r.substring(l);break;case-1:t.length1+=h.length,t.diffs[a++]=i[s],r=r.substring(0,l)+r.substring(l+h.length);break;case 0:h.length<=2*this.Patch_Margin&&a&&i.length!=s+1?(t.diffs[a++]=i[s],t.length1+=h.length,t.length2+=h.length):h.length>=2*this.Patch_Margin&&a&&(this.patch_addContext_(t,f),n.push(t),t=new e.patch_obj,a=0,f=r,o=l)}1!==c&&(o+=h.length),-1!==c&&(l+=h.length)}return a&&(this.patch_addContext_(t,f),n.push(t)),n},e.prototype.patch_deepCopy=function(t){for(var i=[],n=0;n<t.length;n++){var r=t[n],a=new e.patch_obj;a.diffs=[];for(var o=0;o<r.diffs.length;o++)a.diffs[o]=r.diffs[o].slice();a.start1=r.start1,a.start2=r.start2,a.length1=r.length1,a.length2=r.length2,i[n]=a}return i},e.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var i=this.patch_addPadding(e);t=i+t+i,this.patch_splitMax(e);for(var n=0,r=[],a=0;a<e.length;a++){var o,l=e[a].start2+n,f=this.diff_text1(e[a].diffs),s=-1;if(f.length>this.Match_MaxBits?-1!=(o=this.match_main(t,f.substring(0,this.Match_MaxBits),l))&&(-1==(s=this.match_main(t,f.substring(f.length-this.Match_MaxBits),l+f.length-this.Match_MaxBits))||o>=s)&&(o=-1):o=this.match_main(t,f,l),-1==o)r[a]=!1,n-=e[a].length2-e[a].length1;else if(r[a]=!0,n=o-l,l=-1==s?t.substring(o,o+f.length):t.substring(o,s+this.Match_MaxBits),f==l)t=t.substring(0,o)+this.diff_text2(e[a].diffs)+t.substring(o+f.length);else if(l=this.diff_main(f,l,!1),f.length>this.Match_MaxBits&&this.diff_levenshtein(l)/f.length>this.Patch_DeleteThreshold)r[a]=!1;else{this.diff_cleanupSemanticLossless(l);for(var c,f=0,s=0;s<e[a].diffs.length;s++){var h=e[a].diffs[s];0!==h[0]&&(c=this.diff_xIndex(l,f)),1===h[0]?t=t.substring(0,o+c)+h[1]+t.substring(o+c):-1===h[0]&&(t=t.substring(0,o+c)+t.substring(o+this.diff_xIndex(l,f+h[1].length))),-1!==h[0]&&(f+=h[1].length)}}}return t=t.substring(i.length,t.length-i.length),[t,r]},e.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,i="",n=1;n<=t;n++)i+=String.fromCharCode(n);for(n=0;n<e.length;n++)e[n].start1+=t,e[n].start2+=t;var n=e[0],r=n.diffs;if(0==r.length||0!=r[0][0])r.unshift([0,i]),n.start1-=t,n.start2-=t,n.length1+=t,n.length2+=t;else if(t>r[0][1].length){var a=t-r[0][1].length;r[0][1]=i.substring(r[0][1].length)+r[0][1],n.start1-=a,n.start2-=a,n.length1+=a,n.length2+=a}return n=e[e.length-1],r=n.diffs,0==r.length||0!=r[r.length-1][0]?(r.push([0,i]),n.length1+=t,n.length2+=t):t>r[r.length-1][1].length&&(a=t-r[r.length-1][1].length,r[r.length-1][1]+=i.substring(0,a),n.length1+=a,n.length2+=a),i},e.prototype.patch_splitMax=function(t){for(var i=this.Match_MaxBits,n=0;n<t.length;n++)if(!(t[n].length1<=i)){var r=t[n];t.splice(n--,1);for(var a=r.start1,o=r.start2,l="";0!==r.diffs.length;){var f=new e.patch_obj,s=!0;for(f.start1=a-l.length,f.start2=o-l.length,""!==l&&(f.length1=f.length2=l.length,f.diffs.push([0,l]));0!==r.diffs.length&&f.length1<i-this.Patch_Margin;){var l=r.diffs[0][0],c=r.diffs[0][1];1===l?(f.length2+=c.length,o+=c.length,f.diffs.push(r.diffs.shift()),s=!1):-1===l&&1==f.diffs.length&&0==f.diffs[0][0]&&c.length>2*i?(f.length1+=c.length,a+=c.length,s=!1,f.diffs.push([l,c]),r.diffs.shift()):(c=c.substring(0,i-f.length1-this.Patch_Margin),f.length1+=c.length,a+=c.length,0===l?(f.length2+=c.length,o+=c.length):s=!1,f.diffs.push([l,c]),c==r.diffs[0][1]?r.diffs.shift():r.diffs[0][1]=r.diffs[0][1].substring(c.length))}l=this.diff_text2(f.diffs),l=l.substring(l.length-this.Patch_Margin),c=this.diff_text1(r.diffs).substring(0,this.Patch_Margin),""!==c&&(f.length1+=c.length,f.length2+=c.length,0!==f.diffs.length&&0===f.diffs[f.diffs.length-1][0]?f.diffs[f.diffs.length-1][1]+=c:f.diffs.push([0,c])),s||t.splice(++n,0,f)}}},e.prototype.patch_toText=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=e[i];return t.join("")},e.prototype.patch_fromText=function(t){var i=[];if(!t)return i;t=t.split("\n");for(var n=0,r=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;n<t.length;){var a=t[n].match(r);if(!a)throw Error("Invalid patch string: "+t[n]);var o=new e.patch_obj;for(i.push(o),o.start1=parseInt(a[1],10),""===a[2]?(o.start1--,o.length1=1):"0"==a[2]?o.length1=0:(o.start1--,o.length1=parseInt(a[2],10)),o.start2=parseInt(a[3],10),""===a[4]?(o.start2--,o.length2=1):"0"==a[4]?o.length2=0:(o.start2--,o.length2=parseInt(a[4],10)),n++;n<t.length;){a=t[n].charAt(0);try{var l=decodeURI(t[n].substring(1))}catch(e){throw Error("Illegal escape in patch_fromText: "+l)}if("-"==a)o.diffs.push([-1,l]);else if("+"==a)o.diffs.push([1,l]);else if(" "==a)o.diffs.push([0,l]);else{if("@"==a)break;if(""!==a)throw Error('Invalid patch mode "'+a+'" in: '+l)}n++}}return i},e.patch_obj=function(){this.diffs=[],this.start2=this.start1=null,this.length2=this.length1=0},e.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2,e=["@@ -"+e+" +"+t+" @@\n"];var i;for(t=0;t<this.diffs.length;t++){switch(this.diffs[t][0]){case 1:i="+";break;case-1:i="-";break;case 0:i=" "}e[t+1]=i+encodeURI(this.diffs[t][1])+"\n"}return e.join("").replace(/%20/g," ")},this.diff_match_patch=e,this.DIFF_DELETE=-1,this.DIFF_INSERT=1,this.DIFF_EQUAL=0}();var unifiedLineDiff={};!function(e){"use strict";function t(e){var t=new RegExp("["+Object.keys(b).join("")+"]","g"),i=function(e){return b[e]};return String(e).replace(t,i)}function i(e,i){return""===e?"":i===y.DELETE?"<del>"+t(e)+"</del>":i===y.INSERT?"<ins>"+t(e)+"</ins>":t(e)}function n(e,t,i){t?(d.deletes.push(_),_+=1):d.deletes.push(null),i?(d.inserts.push(v),v+=1):d.inserts.push(null),d.lines.push(e)}function r(){return!(p.length<1||m.length<1)&&p[0]===m[0]}function a(){for(;r();)n(p.shift(),!0,!0),m.shift();p.forEach(function(e){n(e,!0,!1)}),m.forEach(function(e){n(e,!1,!0)}),p=[],m=[]}function o(e){e!==y.DELETE&&e!==y.EQUAL||(p.push(u),u=""),e!==y.INSERT&&e!==y.EQUAL||(m.push(g),g=""),""===u&&""===g&&a()}function l(e,t){t!==y.DELETE&&t!==y.EQUAL||(u+=i(e,t)),t!==y.INSERT&&t!==y.EQUAL||(g+=i(e,t))}function f(e){var t=Number(e[0]),i=String(e[1]).split(/\r\n|[\r\n]/),n=i.pop();i.forEach(function(e){l(e,t),o(t)}),l(n,t)}function s(){d={lines:[],inserts:[],deletes:[]},u="",_=1,p=[],g="",v=1,m=[]}function c(e){return s(),e.forEach(f),o(y.EQUAL),d}function h(e,t){var i=diff_match_patch,n=new i,r=n.diff_main(e,t);return n.diff_cleanupSemantic(r),c(r)}var d,u,g,p,m,_,v,b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},y={EQUAL:DIFF_EQUAL,DELETE:DIFF_DELETE,INSERT:DIFF_INSERT};e.getLineDiff=h,e.arrangeDiffs=c}(unifiedLineDiff),AI.Filemanagement=function(){var e={copyFile:"/filemanagement/copy",copyTemplate:"/filemanagement/copyTemplate",createDirectory:"/filemanagement/createdirectory",createFile:"/filemanagement/createfile",deleteDirectory:"/filemanagement/deletedirectory",deleteFile:"/filemanagement/deletefile",directoryDiff:"/filemanagement/directorydiff",downloadFile:"/filemanagement/download",editFile:"/filemanagement/content",fileActions:"/filemanagement/fileactions",fileDiff:"/filemanagement/filediff",files:"/filemanagement/files",folderInfo:"/filemanagement/folderinfo",grep:"/filemanagement/grep",linkFile:"/filemanagement/linkfile",removeFileLink:"/filemanagement/removefilelink",rename:"/filemanagement/rename",restoreFile:"/filemanagement/restorefile",updateLinkedFile:"/filemanagement/updateLinkedfile",uploadFile:"/filemanagement/upload",viewDirectories:"/filemanagement/alldirectories",saveFile:"/filemanagement/save",viewEdit:"/view/edit/"},t=[],i=null,n=!1,r=!1,a=!1,o=!1,l=!1,f="",s=!1,c=!1,h=!1,d=!1,u=!1,g=!1,p=!1,m=!1,_=!1,v=!1,b=!1,y=!1,I=null,A=null,w=!1,k=!1,x=function(e,t,i,n){re("filetree-editor",!1,!1),re("filetree-diff",!1,!1),re("filetree-file-info",!1,!1),ve(e,t,i,n);var r=$("#filetree-dir-search-pattern");k=AI.translate("file_management_search_in_folder"),r.val(k),r.focus(function(){$(this).val()===k&&$(this).val("")})},L=function(){$(".vertical-filler-header").each(function(){$(this).next().css({top:$(this).css("height")})})},E=function(t){if(m){if(t.get(0)===m.get(0))return;m.removeClass("selected")}t.addClass("selected"),m=t,t.attr("path",o);var i=t.attr("data"),n=t.data("view"),r=t.data("status"),a=t.data("statusClass"),l=t.data("link"),f=t.data("linkType");if(i){h=i,d=r,s=l,c=f,u=a;var g=$("#filetree-file-info"),p=i.substr(i.lastIndexOf("/")+1);g.html(AI.translate("file_management_selected_file")+": <strong>"+p+"</strong>"),g.show(),ne("filetree-file-cmd",!1),AI.Request.post({url:e.fileActions,data:{file:i,view:n},dataType:"html",onSuccess:function(e){ne("filetree-file-cmd",!0),ie(e)},onError:function(e,t){AI.Common.Notification.error(AI.translate("file_management_data_download_error"))}})}},C=function(t){De(!1),Se(!1);var i={file:h,view:_},n='<span class="filetree-info-bold';s&&(n+=" filetree-info-linked"),n+='">'+h,u&&(n+='<span class="'+u+'">'),d&&(n+=" ("+d+")"),u&&(n+="</span>"),n+="</span>",$("#filetree-editor-info").html(n),w=t,re("filetree-content",!1,!1),ee(!0,!1),AI.Request.post({url:e.editFile,data:i,dataType:"json",showLoader:!0,onSuccess:function(e){var t=e.data,i=e.warning,n=e.warningStatus,r=e.disableSave,a=e.link,o=e.linkType,s=e.linkNotAllowed;l=r,T(i,n,r),Ee(!s&&!r),Ce(a,o),Te(null!=a),a&&Se(!0),re("filetree-editor",!0,!1),L(),M(t,a||r),f=g.getValue()},onError:function(e,t){AI.LoadingIndicator.off(),re("filetree-content",!0,!1),AI.Common.Notification.error(Fe(AI.translate("file_management_read_file_error"),e)),v=!0,W()}})},M=function(e,i){b=!1;var n=$("#filetree-editor-data");if(!g){n.empty();var r=ace.edit(n.attr("id"));r.$blockScrolling=1/0,r.setTheme("ace/theme/chrome"),r.getSession().setTabSize(4),r.getSession().setUseSoftTabs(!0),r.commands.addCommand({name:"saveFile",bindKey:{win:"Ctrl-S",mac:"Command-S"},exec:function(e){G(!1)},readOnly:!1}),r.session.on("change",function(e){if(!b)if(b=!0,w){var i=ace.require("ace/range").Range,n=g.getSession().getLength();t=[];for(var r=0;r<w.length;r++){var a=w[r]-1;n=Math.min(a+1,n);var o=new i(a,0,a,1);t.push(g.getSession().addMarker(o,"filetree-editor-line-highlight","fullLine",!1))}g.scrollToLine(n,!0,!0,function(){}),g.gotoLine(n,0,!0)}else g.gotoLine(1,0,!0)}),g=r}var a=ace.require("ace/ext/modelist"),o=a.getModeForPath(h);o&&g.getSession().setMode(o.mode),g.getSession().setValue(e),g.focus(),g.setReadOnly(i),i?n.addClass("filetree-editor-readonly"):n.removeClass("filetree-editor-readonly")},T=function(e,t,i){var n=$("#filetree-editor-notification");n.removeClass("editor-warn"),n.removeClass("editor-deny"),n.removeClass("editor-custom"),e&&""!==e?(n.html(e),n.addClass("editor-"+t),n.toggleClass("open",!0)):n.toggleClass("open",!1),$("#filetree-btn-save").toggle(!i)},S=function(){var e={file:h},t=AI.translate("file_management_delete_file_confirm")+"<br><strong>"+h+"</strong> ?";AI.ConfirmDialog().showMessage({message:t,okCallback:D,okArg:e})},D=function(){m=!1;var t={file:h,view:_};re("filetree-right",!1,!1),AI.Request.post({type:"POST",url:e.deleteFile,data:t,dataType:"json",showLoader:!0,onSuccess:function(){J();var e=_e(t.file);ge(),me(e)},onError:function(e,t){AI.LoadingIndicator.off(),re("filetree-right",!0,!1),AI.Common.Notification.error(AI.translate("file_management_delete_file_error"))}})},F=function(){var t={path:h,view:_};window.location=e.downloadFile+"?"+$.param(t)},R=function(){AI.LoadingIndicator.on(),AI.Request.post({type:"POST",url:e.copyTemplate,data:{file:h,view:_},dataType:"json",onSuccess:function(e){AI.LoadingIndicator.off(),pe(_e(e.path)+"/themes/custom"),h=e.path,C()},onError:function(e){AI.LoadingIndicator.off(),AI.Common.Notification.error(AI.translate("file_management_copy_file_error"))}})},N=function(){var e=AI.translate("file_management_delete_folder_confirm_html").replace("%currentDirectoryPath%",o);AI.ConfirmDialog().showMessage({message:e,okCallback:P})},P=function(){var t={path:o,view:_};AI.Request.post({type:"POST",url:e.deleteDirectory,data:t,dataType:"json",showLoader:!0,onSuccess:function(){var e=_e(t.path);ge(),me(e);var i=o;o=i.substring(0,i.lastIndexOf("/")),J()},onError:function(e,t){AI.LoadingIndicator.off(),AI.Common.Notification.error(AI.translate("file_management_delete_folder_error"))}})},O=function(){var t={file:h,view:_},i='<span class="filetree-info-bold">'+h+"</span>";$("#filetree-diff-info").html(i),re("filetree-content",!1,!1),AI.Request.post({url:e.fileDiff,data:t,dataType:"html",showLoader:!0,onSuccess:function(e){AI.LoadingIndicator.off(),re("filetree-editor",!1,!1),re("filetree-diff",!0,!1);var t=$("#filetree-diff-data");t.html(e);var i=$("#filetree-diff-restore-btn");1===parseInt($("#filetree-diff-allowRevert").val())?i.show():i.hide(),setTimeout(function(){t.scrollTop(0)},100),K(),$("#filetree-diff-tabs").tabs()},onError:function(e,t){AI.LoadingIndicator.off(),re("filetree-content",!0,!1),AI.Common.Notification.error(AI.translate("file_management_file_diff_error"))}})},j=function(){var t={dir:o,view:_};$("#filetree-dir-diff-info").html('Hakemiston <span class="filetree-info-bold">'+o+"</span> sisältämät muutokset"),re("filetree-right",!1,!1),re("filetree-file-cmd",!1),re("filetree-file-info",!1),re("filetree-dir-ui",!1),AI.Request.post({url:e.directoryDiff,data:t,dataType:"html",showLoader:!0,onSuccess:function(e){AI.LoadingIndicator.off(),re("filetree-right",!0),re("filetree-content",!1,!1);var t=$("#filetree-dir-diff-data");re("filetree-dir-diff",!0,!1),t.html(e),H(t),$("#tbl-filetree-dirdiff").tablesorter()},onError:function(e,t){AI.LoadingIndicator.off(),re("filetree-content",!0,!1),AI.Common.Notification.error(AI.translate("file_management_file_get_changes_error"))}})},q=function(){var t=$("#filetree-dir-search-ui"),i=t.find("input"),n=i.val();if(""!==n&&n!==k){var r={dir:o,pattern:n,view:_},a=$("#filetree-dir-search-list"),l=$("#search-indicator");l.addClass("open"),AI.Request.post({url:e.grep,data:r,dataType:"html",onSuccess:function(e){l.removeClass("open"),a.html(e),a.scrollTop(0),V(!0),$("a.grepMatch").click(function(){var e=$(this).attr("data-path"),t=$(this).attr("data-line");h=e,C([t])})},onError:function(e,t){AI.Common.Notification.error(AI.translate("file_management_search_error")),i.prop("disabled",!1)}})}},U=function(){V(!1)},V=function(e){var t=$("#filetree-dir-search"),i=$("#filetree-dir-search-close"),n=$("#filetree-dir-search-results"),r=$("#filetree-file-ui"),a=$("#filetree-content-data");e?(t.addClass("open"),n.show(),i.show(),r.hide(),a.hide()):(t.removeClass("open"),n.hide(),i.hide(),r.show(),a.show()),L()},B=function(){var e=AI.translate("file_management_restore_file_confirm_html").replace("%currentEditPath%",h);AI.ConfirmDialog().showMessage({message:e,okCallback:z})},z=function(){var t={file:h,view:_};AI.Request.post({type:"POST",url:e.restoreFile,data:t,dataType:"html",showLoader:!0,onSuccess:function(e){AI.LoadingIndicator.off(),re("filetree-diff",!1,!1),J(null,null);var i=_e(t.file);ge(),me(i)},onError:function(e,t){AI.LoadingIndicator.off(),AI.Common.Notification.error(AI.translate("file_management_restore_file_error"))}})},Q=function(){re("filetree-content",!0,!1),re("filetree-diff",!1,!1)},K=function(){for(var e=unifiedLineDiff.getLineDiff($("#original-diff-file").text(),$("#current-diff-file").text()),t="",i="",n="",r="",a="",o="",l="",f=function(e,t){var i=void 0;return i=null===t||""===t?"":t,'<span class="'+e+'">'+i+"</span><br />"},s=0;s<e.lines.length;s++){var c="equal",h=e.lines[s];h.match(/^<(ins|del)>[^<]*<\/(ins|del)>$/i)&&(h=h.substr(5,h.length-11)),null===e.deletes[s]?c="insert":null===e.inserts[s]&&(c="delete"),null!==e.deletes[s]&&(r+=f(c,e.deletes[s]),a+=f(c,h)),null!==e.inserts[s]&&(o+=f(c,e.inserts[s]),l+=f(c,h)),t+=f(c,e.deletes[s]),i+=f(c,e.inserts[s]),n+=f(c,h)}$("#filetree-diff-delete pre").html(t),$("#filetree-diff-insert pre").html(i),$("#filetree-diff-lines pre").html(n),$("#filetree-original-rows pre").html(r),$("#filetree-original-lines pre").html(a),$("#filetree-current-rows pre").html(o),$("#filetree-current-lines pre").html(l),$(".diff-file-contents").remove()},H=function(e){e.scrollTop(0)},J=function(t,i,n){var r=$("#filetree-content-data");r.scrollTop(0),re("filetree-right",!1,!1),re("filetree-file-cmd",!1),re("filetree-file-info",!1),Q();var a=void 0,l=i;t?a=t:(a=o,l=_),o=a,_=l;var f={dir:a,view:l};AI.Request.post({url:e.files,data:f,dataType:"html",onSuccess:function(e){if(AI.LoadingIndicator.off(),r=$("#filetree-content-data"),re("filetree-right",!0,!1),r.html(e),H(r),$("#tbl-filetree").tablesorter({textExtraction:function(e){var t=$(e),i=t.data("sortValue");return void 0===i?t.html():i}}),$("#tbl-filetree tbody tr").click(function(e){E($(this))}),$("#tbl-filetree tbody tr").dblclick(function(e){E($(this)),C()}),!n){var t=$("#tbl-filetree tbody tr:first");E(t)}re("filetree-dir-search",!0,!1),L()},onError:function(e,t){AI.LoadingIndicator.off(),AI.Common.Notification.error(AI.translate("file_management_file_listing_error"))}}),te("&nbsp;"),AI.Request.post({url:e.folderInfo,data:f,dataType:"html",onSuccess:function(e){te(e)},onError:function(e,t){AI.Common.Notification.error(AI.translate("file_management_file_listing_error"))}}),ne("filetree-dir-cmd",!1),f={file:a,view:l},ne("filetree-dir-cmd",!1),AI.Request.post({url:e.fileActions,data:f,dataType:"html",onSuccess:function(e){ne("filetree-dir-cmd",!0),$("#filetree-dir-cmd").html(e);var t=$("#filetree-btn-new-folder");t.length>0&&($('<div id="file-uploader" class="filetree-dir-cmd-buttons-row"></div>').insertAfter(t.parent()),oe())},onError:function(e,t){AI.Common.Notification.error(AI.translate("file_management_fileActions_error"))}}),n&&re("filetree-content",!1,!1)},G=function(t){if(!l){var i={data:g.getValue(),file:h,view:_};ee(!1,!1),v=!0,AI.Request.post({url:e.saveFile,data:i,dataType:"json",showLoader:!0,onSuccess:function(){ee(!0,!0),AI.LoadingIndicator.off(),f=i.data,t?W():(g.focus(),De(AI.translate("file_management_file_saved")))},onError:function(e,t){ee(!0,!0),AI.LoadingIndicator.off();var i=e.responseJSON.message||"";AI.Common.Notification.error(AI.translate("file_management_file_save_error")+"\n"+i),g.focus()}})}},X=function(e,t){AI.ConfirmDialog().showMessage({message:AI.translate("file_management_save_file_changes"),okCallback:e,cancelCallback:t,okLabel:AI.translate("save_btn_label"),cancelLabel:AI.translate("file_management_discard_changes")})},Z=function(){if(f!==g.getValue()){X(function(){G(!0)},function(){W()})}else W()},W=function(){if(g){for(var e=0;e<t;e++)g.getSession().removeMarker(t[e]);g.setValue(""),f=""}v&&(ge(),J()),v=!1,re("filetree-editor",!1,!1),re("filetree-content",!0,!1),re("filetree-btn-return-to-view",!1,!1),L()},Y=function(){return $("#filetree-editor").is(":visible")},ee=function(e,t){var i=$("#filetree-btn-save");i.attr("disabled",!e),
i.fadeTo(t?200:0,e?1:.4)},te=function(e){$("#filetree-dir-info").html(e),re("filetree-dir-info",!0,!1)},ie=function(e){$("#filetree-file-cmd").html(e),L()},ne=function(e,t){var i=$("#"+e);i.find("button").each(function(){$(this).attr("disabled",!t)}),t?i.stop().fadeTo(200,1):i.stop().fadeTo(200,.4)},re=function(e,t,i){var n=$("#"+e);t?(n.show(),i&&n.slideDown()):i?n.slideUp(function(){$(this).addClass("hidden")}):n.hide()},ae=function(e,t){AI.LoadingIndicator.on(),le(!0),re("filetree-content-data",!1,!1)},oe=function(){$("#file-uploader").show();var t={view:_,path:o,overwrite:!1},i=new qq.FineUploader({element:$("#file-uploader")[0],request:{endpoint:e.uploadFile,params:t},debug:!1,multiple:!1,showMessage:function(){},autoUpload:!1,messages:{typeError:"Tiedoston {file} tyyppi ei ole sallittu. Sallitut tyypit: {extensions}.",sizeError:"{file} on liian iso, suurin sallittu koko on {sizeLimit}.",tooManyFilesError:"Voit tiputtaa vain yhden tiedoston"},callbacks:{onSubmit:function(e,n){var r=!1;if($("#tbl-filetree tbody tr").each(function(e,t){var i=$(t).attr("data"),a=i.split("/");a[a.length-1]===n&&(r=!0)}),r){var a=AI.translate("file_management_upload_filename_exists_html").replace("%filename%",n);AI.ConfirmDialog().showMessage({message:a,okCallback:function(){ae(),t.overwrite=!0,i.setParams(t),i.uploadStoredFiles()},cancelCallback:function(){ae(),i.setParams(t),i.uploadStoredFiles()},okLabel:AI.translate("file_management_replace"),cancelLabel:AI.translate("file_management_keep_both")})}else ae(),i._options.autoUpload=!0,i.setParams(t)},onProgress:function(e,t,i,n){var r=Math.round(i/n*100),a=t+": "+r+"%";$("#filetree-upload-progress").html(a)},onError:function(e,t,i,n){AI.Common.Notification.error(Fe(AI.translate("file_management_file_upload_error"),n)),AI.LoadingIndicator.off(),le(!1),re("filetree-content-data",!0,!1)},onComplete:function(e,t,i){if(i.success)ge(),J();else{var n=i.message||"";AI.Common.Notification.error(AI.translate("file_management_file_upload_error")+"\n"+n)}AI.LoadingIndicator.off(),le(!1),re("filetree-content-data",!0,!1)}}})},le=function(e){re("filetree-upload-progress",e,1==e),re("filetree-dir-ui",!e,!1)},fe=function(){de({action:"createFile",mode:"file"},!1,!1)},se=function(){de({action:"createDirectory",mode:"dir"},!1,!1)},ce=function(){var e=h.split("/"),t=e[e.length-1];de({action:"rename",mode:"file",value:t},!1,!1)},he=function(){var e=function(){re("filetree-file-info",!1,!1)},t=o.split("/"),i=t[t.length-1];de({action:"rename",mode:"dir",value:i},e,!1)},de=function(t,i,n){var r=t.action,a=t.mode,l=t.value?t.value:"",f=void 0,s=void 0,c=void 0;$("#filetree-name-prompt form #txt").val(l),$("#filetree-name-prompt").dialog({closeOnEscape:!1,autoOpen:!0,modal:!0,width:"400px",buttons:{Ok:function(){var t=$("#txt").val();if(0!==t.length){var l=o+"/"+t,d={view:_};"rename"===r?"file"===a?(d.from=h,d.to=l):(f=o,s=f.substring(0,f.lastIndexOf("/")),c=s+"/"+t,d.from=f,d.to=c):d.file=l,ye(),i&&i(),AI.Request.post({url:e[r],data:d,dataType:"json",showLoader:!0,onSuccess:function(e,t,i){if(AI.LoadingIndicator.off(),e.success){var l=_e(null!=d.to?d.to:d.file);"rename"===r&&"dir"===a?(ge(),o=c):"createfile"===r?ge():pe(),me(l),J(),n&&n()}else AI.Common.Notification.error(AI.translate("error")+": "+e.message)},onError:function(e,t){AI.LoadingIndicator.off(),AI.Common.Notification.error(Fe(AI.translate("file_management_file_creation_error"),e))}})}},Peru:function(){ye()}}}),$("#filetree-name-prompt form").submit(function(){return!1})},ue=function(e){return $("#filetree-tree").fancytree("getTree").getNodeByKey(e)},ge=function(e,t){var i=e;null==i&&(i=o);var n=ue(i);if(n){var r=n.parent;if(null!=r)return void pe(r.key,t)}t&&t()},pe=function(e,t){var i=e;null==i&&(i=o);var n=$("#filetree-tree").fancytree("getTree"),r=n.getNodeByKey(i);r&&r.getLevel()>1&&!r.isLoading()&&r.isLazy()&&(r.load(!0),r.setActive(!0)),t&&t()},me=function(e){var t=ue(e+"/interface/cache");t&&t.removeChildren(),(t=ue(e+"/interface/compile"))&&t.removeChildren()},_e=function(e){if(e){var t=e.split("/");return t[0]+"/"+t[1]}return!1},ve=function(t,i,r,a){I=$("#filetree-tree");var l=$.extend({},AI.Common.fancytreeConfig,{source:{url:e.viewDirectories,data:{path:"/"},cache:!1},lazyLoad:function(t,i){var n=i.node;i.result={url:e.viewDirectories,data:{path:n.key,view:n.data.view},cache:!1}},click:function(e,t){var i=t.node;re("filetree-btn-return-to-view",!1,!1),V(!1);var r=!1;if(i.key!==n&&i.getLevel()>1){var a=function(){re("filetree-editor",!1,!1),re("filetree-dir-diff-btn",!0,!1),re("filetree-content",!1,!1),re("filetree-dir-diff",!1,!1),J(i.key,i.data.view),n=i.key};if(Y()&&f!==g.getValue()){r=!0;X(function(){G(!0),a()},function(){W(),a()})}r||a()}return!r}}),s=!1;r&&(s=!0),t&&i&&$.extend(l,{init:function(e,i){var r=I.fancytree("getTree").getNodeByKey(t);if(!r)return void AI.Common.Notification.error(AI.translate("file_management_invalid_path"));r.setActive(),r.makeVisible(!0),r.getLevel()>1&&(re("filetree-editor",!1,!1),re("filetree-dir-diff-btn",!0,!1),re("filetree-content",!1,!1),re("filetree-dir-diff",!1,!1),J(r.key,r.data.view,s),n=r.key,$("#filetree-tree").animate({scrollTop:$(r.li).offset().top-$("#filetree-tree").offset().top+$("#filetree-tree").scrollTop()}))},source:{url:e.viewDirectories,data:{path:"/",load:t},cache:!1,success:function(){0!==a&&(h=a,_=i,o=t,a!==r&&R()),s&&be(t,i,r)}}}),I.fancytree(l)},be=function(e,t,i){h=i,_=t,o=e,C(),re("filetree-btn-return-to-view",!0,!1)},ye=function(){$("#filetree-name-prompt").dialog("close")},Ie=function(t){var i=function(t){var i=e.viewEdit+t;window.location.href=i};if(f!==g.getValue()){X(function(){G(!1)},function(){i(t)})}else i(t)},Ae=function(e,t){var i=e;i||(i=" ");var n=AI.translate("file_management_copy_file").replace("%src%",i);return t&&(n+=" '"+t+"'"),n},we=function(){var t=Ae(h,!1);a=!1,$("#filetree-copy-prompt").dialog({closeOnEscape:!1,title:t,autoOpen:!0,modal:!0,width:700,height:500,cookieId:"copy-prompt",buttons:{copy:{text:AI.translate("copy_btn_label"),click:function(){if(!1!==a){if(a.getLevel()<=1)return;var t={dir:r,file:h,destinationView:a.data.view,sourceView:_};AI.Request.post({url:e.copyFile,data:t,dataType:"json",showLoader:!0,onSuccess:function(e){var i=_e(t.dir);me(i),ge(r),J()},onError:function(e,t){AI.LoadingIndicator.off(),AI.Common.Notification.error(Fe(AI.translate("file_management_file_copy_error"),e))}}),$("#filetree-copy-prompt").dialog("close")}}},cancel:{text:AI.translate("cancel_btn_label"),click:function(){$(this).dialog("close")}}},close:function(){i&&(i.fancytree("destroy"),i=null)}}),i=$("#filetree-copy-prompt-tree");var n=$.extend({},AI.Common.fancytreeConfig,{source:{url:e.viewDirectories,data:{path:"/",load:o},cache:!1},lazyLoad:function(t,i){var n=i.node;i.result={url:e.viewDirectories,data:{path:n.key,view:n.data.view},cache:!1}},init:function(e,t){var n=i.fancytree("getTree").getNodeByKey(o);n.setActive(),n.makeVisible(!0)},click:function(e,t){var i=t.node;r=i.key,a=i;var n=Ae(h,i.key);return $("#filetree-copy-prompt").dialog("option","title",n),!0}});i.fancytree(n)},ke=function(){$("#filetree-link-prompt-files").html(""),$("#filetree-link-prompt").dialog({closeOnEscape:!1,autoOpen:!0,modal:!0,width:900,height:500,cookieId:"link-prompt",resizable:!1,buttons:{ok:{text:AI.translate("link_btn_label"),id:"btn-ok",click:function(){$e(p),$(this).dialog("close")}},cancel:{text:AI.translate("cancel_btn_label"),click:function(){$("#filetree-editor-linkurl select").val("URL"),$(this).dialog("close")}}},close:function(){A&&(A.fancytree("destroy"),A=null)}}),Me(!1),A=$("#filetree-link-prompt-tree");var t=$.extend({},AI.Common.fancytreeConfig,{source:{url:e.viewDirectories,data:{path:"/",load:o},cache:!1},lazyLoad:function(t,i){Me(!1);var n=i.node;i.result={url:e.viewDirectories,data:{path:n.key,view:n.data.view},cache:!1}},init:function(e,t){var i=A.fancytree("getTree").getNodeByKey(o);i.setActive(),i.makeVisible(!0)},click:function(t,i){var n=i.node;n.getLevel()<=1||AI.Request.post({url:e.files,data:{dir:n.key,view:n.data.view},dataType:"html",onSuccess:function(e){Me(!1);var t=$("#filetree-link-prompt-files");t.html(e);var i=t.find(".tablesorter");i.tablesorter(),$("#tbl-filetree").tablesorter();var n=!1;i.find("tr").click(function(e){n&&n.removeClass("selected");var t=$(this);t.addClass("selected"),n=t;var i=t.attr("data");p=i,Me(i)})}})}});A.fancytree(t)},$e=function(t){var i=$("#filetree-editor-linkurl select option:selected").data("type"),n="url"===i?$("#filetree-editor-linkurl input").val():t;if(!n)return!1;var r={path:h,dst:n,type:i,view:_};return AI.Request.post({url:e.linkFile,data:r,dataType:"json",showLoader:!0,onSuccess:function(e){AI.LoadingIndicator.off(),s=n,c=i,Ce(n,i),Te(!0),Le(),v=!0},onError:function(e,t){AI.LoadingIndicator.off(),AI.Common.Notification.error(Fe(AI.translate("file_management_link_error"),e))}}),!1},xe=function(){var t={path:h,view:_};return AI.Request.post({url:e.removeFileLink,data:t,dataType:"json",onSuccess:function(e){s=!1,Te(!1),Ce("","url");var t=g.getValue();M(t,!1),Se(!1),v=!0},onError:function(e,t){AI.Common.Notification.error(Fe(AI.translate("file_management_remove_link_error"),e))}}),!1},Le=function(){var t={path:h,type:c,view:_};AI.Request.post({url:e.updateLinkedFile,data:t,dataType:"json",showLoader:!0,onSuccess:function(e){AI.LoadingIndicator.off(),e.success&&null!=e.data?(M(e.data,!0),Se(!0),e.encoded&&AI.warning(AI.translate("file_management_updated_file_changed_into_utf8"))):AI.Common.Notification.error(e.msg?e.msg:AI.translate("file_management_download_error"))},onError:function(e,t){AI.Common.Notification.error(AI.translate("file_management_update_link_error")),AI.LoadingIndicator.off()}})},Ee=function(e){$("#filetree-editor-linkurl").toggle(e)},Ce=function(e,t){s=e,c=t;var i=$("#filetree-editor-linkurl select");i.find("option").attr("selected",!1),i.find('option[data-type="'+t+'"]').attr("selected",!0),$("#filetree-editor-linkurl input").val(e),$("#filetree-editor-linkurl select").off("change").change(function(){"local"===$(this).find("option:selected").data("type")&&ke()})},Me=function(e){var t="Linkitä tiedosto '"+h+"'";e&&(t+=" tiedostoon: '"+e+"'"),$("#filetree-link-prompt").dialog("option","title",t),$(".ui-dialog #btn-ok").button(e?"enable":"disable")},Te=function(e){$("#filetree-editor-linkurl input").attr("disabled",!!e&&"disabled"),$("#filetree-editor-linkurl select").attr("disabled",!!e&&"disabled"),$("#filetree-linked").toggle(e),$("#filetree-not-linked").toggle(!e),$("#filetree-editor-info .filetree-info-bold").toggleClass("filetree-info-linked",e)},Se=function(e){$("#filetree-editor-link-notification").toggleClass("open",e)},De=function(e){var t=$("#filetree-editor-msg");if(e){t.html(e),t.fadeIn(300);var i=function(){t.fadeOut(300)};y&&clearTimeout(y),y=setTimeout(i,1e3)}else t.hide()},Fe=function(e,t){return e+(": "+t.responseJSON.message||"")};return{init:x,restoreFile:B,returnToView:Ie,saveFile:G,closeEdit:Z,editFile:C,linkFile:$e,removeLinkToURL:xe,updateLinkedFile:Le,diffFile:O,diffFolder:j,closeDiff:Q,grepFolder:q,closeGrepResults:U,renameFile:ce,deleteFile:S,promptCopyDestination:we,downloadFile:F,deleteFolder:N,renameFolder:he,createFile:fe,createFolder:se,copyTemplateFile:R}}();
